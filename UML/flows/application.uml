@startuml
start

repeat
  partition "Phase 1: Pre-Calculation" {

      :1.1: Get LTOs from [live-trades];
      :1.2: Get "balance" and "data_dict";
      :1.3: Query the status of the LTOs from the broker;
      :1.4: Update LTOs;
      :1.5: Write the LTOs to [live-trades] and [hist-trades];
      :1.6: 1.6: Clean-up lto_dict from the "closed" ones;
  }

  partition "Phase 2: Calculation" {
    partition Analyzer {
      :2.1: Generate "analysis_dict";
    }
    partition Algoritm {
      :2.2: Generate "trade_dict";
    }
    :2.3: Execute the trade_dict if any;
  }

  partition "Phase 3: Post-Calculation" {
    fork
      :Monitor Account;
      :Write OOs\nto [observer];
    fork again
      :Write new TOs\nto [live-trades];
    end fork
  }
repeat while (Wait until new period)
@enduml